library(dplyr)
library(ggplot2)
library(shinydashboard)
library(shiny)
library(shinycssloaders)
library(plotly)
library(lubridate)
library(spotifyr)
library(tidyr)
library(shinyWidgets)
library(shinyjs)

####   Wczytanie Danych   ####


####   Style   ####

HTML_styles <- '
      * {
        font-family: "Gotham";
      }
      .content {
        min-height: 1000px;
      }

      body {
        color: #fff;
        background-color: #242424;
      }
      .box-header {
      background-color: #040404;
      }
      .main-sidebar .sidebar .sidebar-menu {
        position: fixed;
        width: 230px;
        height: 100%;
        background-color: #040404;
      }
      .nav-tabs-custom>.nav-tabs>li.active>a{
       background-color: #1DB954;
        color: #fff;
      }
      .nav-tabs-custom>.nav-tabs>li.active {
        border-top-color: #191414;
        }


      html {
        font-size: 16px;
        color: #FFFFFF !important;
      }
      .content-wrapper .content {
          background-color: #121212;
          margin-bottom: 100px;
          
      }
      .content{
        margin-bottom: 100px;
      }
      
      * {
          font-family: "Open Sans", sans-serif;
          letter-spacing: -0.35px;
      }

      skin-blue .main-sidebar {
        background-color: #040404;
      }
      .logo {
        background-color:  #040404 !important;
        position:fixed;
      }
      .navbar {
        background-color:  #040404 !important;
      }
      #sidebarCollapsed {
        background-color: #040404;
      }

      .skin-blue .main-sidebar .sidebar .sidebar-menu  a{
        border-radius: 5px;
        border-color: transparent;
      }


      .top-image {
        display: block;
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 20px;
        width: 90%;
        box-shadow: 10px 5px 5px black;
        object-fit: cover;
        height: 162px;
        width: 162px;
      }


      .top-text {
        display: inline-block;
        margin-left: 20px;
        margin-bottom: 55px;
      }


      .box1 {
        background-color: #242424;
        border-top: 0;
        transition: 0.3s;
        min-width: 200px;
        min-height:350px;
        max-width: 320px;
        column-gap: 10px;
        margin: 20px;
        border-radius:5px;
      }
      box11 {
        background-color: #242424;
        border-top: 0;
        transition: 0.3s;
        min-width: 400px;
        min-height:800px;
        
        column-gap: 30px;
        margin: 20px;
        border-radius:5px;
      }
      .box{
      background-color: #121212;
      border-top:0;
      }
      .col-sm-6 {
      width: 20%;
      min-width: 220px;
      }
      .us-image{
        width: 250px;
        height: 250px;
        margin: 10px;
      }

      .text-fav {
        margin-left:30px;
        font-weight:bold;

      }
      .box1:hover {
        background-color: #2a2a2a
      }
      .box11:hover {
        background-color: #2a2a2a
      }
      .description-box:: hover {
        background-color: #2a2a2a
      }
      .description-box{
        background-color: #242424;
        border-top: 0;
        transition: 0.3s;
        margin: 20px;
        border-radius:5px;
      }
      .us-box{
        background-color: #242424;
        border-top: 0;
        transition: 0.3s;
        margin: 20px;
        border-radius:5px;
        min-width: 300px;
        min-height: 600px;
        
      }
      
      .pretty .state label {
        color: #b8c7ce;
        height:20px;

      }


      }
      .shiny-input-checkboxgroup label~.shiny-options-group, .shiny-input-radiogroup label~.shiny-options-group {
      margin-top:20px;

      }


  .pretty .state label {
    top:0;
    margin-bottom:10px;
    margin-top:10px;

  }
  .pretty .state label:hover {
    top:0;
    margin-bottom:10px;
    margin-top:10px;
    color: #FFFFFF;
  }



  .pretty .state label:before {
  top:10px;}
  .pretty .state label:after {
  top:10px;}



      .control-label{
      font-weight:600;
      margin-bottom: 20px;
      }


      .irs{
      width: 500px;

      }
      .suwak-panel {
        position: fixed;
        bottom: 0;
        width: 100%;
        background-color: #2a2a2a;
        height: 100px;
        left: 0;
        z-index: 1000;
      }
      

          .irs--shiny .irs-bar {
        top: 25px;
        height: 8px;
        border-top: 1px solid #1DB954;
        border-bottom: 1px solid #1DB954;
        background: #1DB954;
          }
      .irs--shiny .irs-from, .irs--shiny .irs-to, .irs--shiny .irs-single {
      color: #FFFFFF;
      text-shadow: none;
      line-height:1px;
      padding: 4px;
      background-color:#121212;
      border-radius: 3px;
      font-size: 11px;

      }
      .icons-box{
        width: 200px;
        margin-top:30px;
        margin-bottom:0;
        margin-left: auto;
        margin-right: auto;
        display: flex;
        justify-content: center;
        flex-direction: row;
      }
      
      .suwak-container{
        display: flex;
        justify-content: center;
        flex-direction: row;
        
        position: fixed;
        bottom: 0;
        width: 100%;
        background-color: #2a2a2a;
        height: 100px;
        left: 0;
        z-index: 1000;
        
        padding: 0 16px;
      }
      
      .left-caption {
        width: 200px;
        
        display: flex;
        justify-content: center;
        flex-direction: start;
        height: 100%;
        align-items: center;
      }
      .right-caption {
        width: 200px;
        
        display: flex;
        justify-content: center;
        flex-direction: end;
        height: 100%;
        align-items: center;
      }
      
      
      .center-lower-panel {
        margin: auto;
        width: 500px;
        display: flex;
        justify-content: center;
        flex-direction: column;
        z-index: 2000;
      }
      
      .suwak {
        margin-top:-30px;
        margin-left:auto;
        margin-right:auto;
        margin-bottom:30px;
        width: 100%;
      }
      
      
      .app-image {
        box-shadow: none;
      
      }
      
      .our-image {
    vertical-align: middle;
    position: fixed;
    bottom: 100px;
      }
      .left-caption{
      justify-content: left;
      }
      '


nieok <- '

      .top-image {
        border-radius:5px;
        position:  absolute;
      }
      
      .image-container {
          height: 0;
          width: 20%;
          padding-bottom: 20%;
      }'


####   Sraka   ####

slider_start <- as.Date("2022-01-01")
slider_stop <- as.Date("2023-12-31")

people <- c("Karolina", "Bartek", "Filip")

person <- "Karolina"



####   UI   ####



ui <- dashboardPage(
  title = "Jestem Akustyczny",
  skin = "green",
  dashboardHeader(
    title = span("projekt - JA")),
  dashboardSidebar(
    width = "220px",
    sidebarMenu(
      id = "tabs",
      h3("Features", style = "margin-left: 3px;"),
      menuItem("  Wrapped", tabName = "wrapped", icon = icon('music')),
      menuItem("  Compatibility", tabName = "compatibility", icon = icon('link')),
      menuItem("  Playlist", tabName = "playlist", icon = icon('headphones')),
      menuItem("  Summary", tabName = "summary", icon = icon('music')),
      h3("Choose person", style = "margin-left: 3px"),
      prettyRadioButtons(
        inputId = "user",
        label = NULL,
        thick = TRUE,
        fill = TRUE,
        shape = "square",
        animation = "jelly",
        choices = people,
        selected = person,
        status = "default"))),
  dashboardBody(
    tags$head(tags$style(HTML(HTML_styles))),
    tags$link(rel = "stylesheet", type = "text/css", href = "custom.css"),
    tabItems(
      tabItem(
        tabName = "wrapped",
        fluidPage(
          # Tutaj kod dla wrapped
          uiOutput("wrapped_title"))),
      tabItem(
        tabName = "compatibility",
        fluidPage(
          # Tutaj kod dla compatibility
          uiOutput("compatibility_title"))),
      tabItem(
        tabName = "playlist",
        fluidPage(
          # Tutaj kod dla playlist
          uiOutput("playlist_title"))),
      tabItem(
        tabName = "summary",
        fluidPage(
          # Tutaj kod do podsumowania
          uiOutput("summary_title")))),
    div(
      div(
        class = "left-caption",
        uiOutput("left_caption"),
        uiOutput("heart")),
      div(
        class = "center-lower-panel",
        div(
          icon(id = "backward", "backward", style = "z-index:100; cursor:pointer; margin: auto;"),
          icon("pause", style = "margin: auto;"),
          icon("forward",  id = "forward", style = "z-index:100; cursor:pointer; margin: auto;"),
          class = "icons-box"),
        div(
          class = "suwak",
          sliderInput(
            "Date",
            "",
            min = slider_start,
            max = slider_stop,
            value = c(slider_start,slider_stop),
            timeFormat = "%d.%m.%y"))),
#      div(
#        class = "right-caption")
    class = "suwak-container"
)))


####   Server   ####


server = function(input, output, session) {
  
  ####   Praca na Danych   ####
  
  
  
  ####   Animacja   ####
  
  forward_date <- function() {
    val = input$Date
    val[2] <- val[2] + 1
    updateSliderInput(
      session,
      "Date",
      value = val,
      min = START_DATE,
      max = END_DATE,
      timeFormat = "%d.%m.%y")
  }
  
  backward_date <- function() {
    val = input$Date
    val[1] <- val[1] - 1
    print(input$Date)
    updateSliderInput(
      session,
      "Date",
      value = val,
      min = START_DATE,
      max = END_DATE,
      timeFormat = "%d.%m.%y"
    )
    print(input$Dates)
  }
  
  change_person <- function(person) {
    updateCheckboxInput(session, inputId = "user", value = person)
  }
  
  
  observe({
    onclick("forward", forward_date)
    onclick("backward", backward_date)
  })
  
  
  
  ####   Nagłówki, opisy ####
  
  output$wrapped_title <- renderUI({
    div(
      h1(
        paste0("Custom Wrapped for: ", input$user),
        class = "text-fav"),
      h3(
        paste0("from ", input$Date[1], " to ", input$Date[2]),
        class = "text-fav",
        style = "margin-top:-5px;"))
  })
  
  
  output$compatibility_title <- renderUI({
    div(h1("Compatibility"),
        class = "text-fav")
  })
  
  
  output$playlist_title <- renderUI({
    div(h1("Playlist"),
        class = "text-fav")
  })
  
  output$summary_title <- renderUI({
    div(h1("Summary"),
        class = "text-fav")
  })
  
  
  ####   Footer   ####
  
  output$left_caption <- renderUI({
    h4(paste0(input$user), style = "height: 100%; margin: 5px;")
    
  })
  
  
  output$heart <- renderUI({
    tags$a(style = "z-index:100; cursor:pointer; margin-top: 5px; margin-left: 5px;",
           href = "https://www.youtube.com/watch?v=ISoCbWBqsYI",
           target="_blank",
           icon(id = "star", "star", style = "color : white")
    ) 
  })
  
  
}


shinyApp(ui, server)
